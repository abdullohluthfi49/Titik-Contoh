<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager - Titik Fiksi</title>

  <!-- âœ… Netlify Identity Widget (KUNCI LOGIN) -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <!-- âœ… Tema Admin (Glass Premium) -->
  <link rel="stylesheet" href="./admin.css" />

  <!-- âœ… Preview style (untuk panel preview di kanan) -->
  <link rel="stylesheet" href="./preview.css" />
</head>

<body>

  <!-- âœ… Overlay (muncul saat panel terbuka) -->
  <div id="tfOverlay" class="tf-overlay tf-hide"></div>

  <!-- âœ… Panel tools admin -->
  <div id="tfPanel" class="tf-panel tf-hide" aria-hidden="true">
    <button id="tfClosePanel" class="tf-panel-close" type="button" title="Tutup">âœ•</button>

    <h4>ğŸ› ï¸ Admin Tools</h4>
    <p>Akses cepat untuk penulis</p>

    <div class="tf-actions">
      <a class="tf-btn tf-btn-primary" href="/tools/generator.html" target="_blank" rel="noopener">
        âš™ï¸ Generator
      </a>

      <a class="tf-btn" href="/" target="_blank" rel="noopener">
        ğŸŒ Buka Website
      </a>

      <button class="tf-btn tf-btn-danger" type="button" id="tfLogoutBtn">
        ğŸšª Logout
      </button>
    </div>
  </div>

  <!-- âœ… Tombol floating -->
  <button id="tfFab" class="tf-fab tf-hide" type="button" title="Admin Tools">
    <span class="tf-fab-icon">âš™ï¸</span>
  </button>

  <!-- âœ… Wadah CMS -->
  <div id="nc-root"></div>

  <!-- âœ… Decap CMS versi lokal (STABIL) -->
  <script src="./vendor/decap-cms.js"></script>

  <script>
    function tfOpenPanel() {
      const panel = document.getElementById("tfPanel");
      const overlay = document.getElementById("tfOverlay");
      if (!panel || !overlay) return;

      panel.classList.remove("tf-hide");
      overlay.classList.remove("tf-hide");
      panel.setAttribute("aria-hidden", "false");
    }

    function tfClosePanel() {
      const panel = document.getElementById("tfPanel");
      const overlay = document.getElementById("tfOverlay");
      if (!panel || !overlay) return;

      panel.classList.add("tf-hide");
      overlay.classList.add("tf-hide");
      panel.setAttribute("aria-hidden", "true");
    }

    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        const fab = document.getElementById("tfFab");
        const logoutBtn = document.getElementById("tfLogoutBtn");
        const closeBtn = document.getElementById("tfClosePanel");
        const overlay = document.getElementById("tfOverlay");

        if (user && fab) {
          fab.classList.remove("tf-hide");
        }

        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }

        if (fab) {
          fab.addEventListener("click", () => tfOpenPanel());
        }

        if (closeBtn) closeBtn.addEventListener("click", () => tfClosePanel());
        if (overlay) overlay.addEventListener("click", () => tfClosePanel());

        if (logoutBtn) {
          logoutBtn.addEventListener("click", () => {
            window.netlifyIdentity.logout();
            window.location.reload();
          });
        }
      });
    }

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") tfClosePanel();
    });
  </script>

  <noscript>Aktifkan JavaScript untuk membuka Admin.</noscript>
</body>
</html>
